<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - OSLIRA</title>
    
    <!-- Tailwind CSS -->
    <link rel="stylesheet" href="/assets/css/tailwind.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/assets/images/favicon.svg">
    
    <!-- Page-specific metadata -->
    <meta name="robots" content="noindex, nofollow">
    <meta name="description" content="OSLIRA Admin Panel - Platform Management">
    
    <!-- CRITICAL: Inline CSS to block page immediately -->
    <style>
        /* Hide everything until admin guard approves */
        html, body {
            visibility: hidden !important;
            opacity: 0 !important;
            overflow: hidden !important;
        }
        
        /* Only password screen is visible */
        #admin-password-screen,
        #admin-password-screen * {
            visibility: visible !important;
            opacity: 1 !important;
        }
    </style>
</head>
<body class="admin-page">
    <!-- NOTHING HERE - Guard will inject everything -->
    
    <!-- 
        CRITICAL: Admin Guard MUST load FIRST and SYNCHRONOUSLY
        This blocks ALL other scripts from loading until password is verified
    -->
    <script src="/core/env-manager.js"></script>
    <script src="/pages/admin/admin-guard.js"></script>
    
    <!-- 
        Script loader will ONLY run AFTER guard passes
        This is triggered by the 'admin:guard:passed' event
    -->
    <script>
        console.log('üìã [Admin] Waiting for guard authorization...');
        
        // WAIT for admin guard to authorize before loading anything
        window.addEventListener('admin:guard:passed', function(event) {
            console.log('üîì [Admin] Guard passed - loading scripts', event.detail);
            
            // Set page identifier for script loader
            window.OSLIRA_PAGE = 'admin';
            
            // NOW load the script loader (which will load all other scripts)
            const scriptLoader = document.createElement('script');
            scriptLoader.src = '/core/script-loader.js';
            scriptLoader.onload = function() {
                console.log('‚úÖ [Admin] Script loader initialized');
            };
            scriptLoader.onerror = function() {
                console.error('‚ùå [Admin] Failed to load script-loader');
                document.getElementById('admin-error').classList.remove('hidden');
                document.getElementById('admin-error-message').textContent = 'Failed to load core scripts. Please refresh the page.';
            };
            document.head.appendChild(scriptLoader);
        });
        
        // Global error boundary
        window.addEventListener('error', function(event) {
            console.error('‚ùå [Admin] Global error:', event.error);
        });
        
        window.addEventListener('unhandledrejection', function(event) {
            console.error('‚ùå [Admin] Unhandled promise rejection:', event.reason);
        });
    </script>
</body>
</html>
